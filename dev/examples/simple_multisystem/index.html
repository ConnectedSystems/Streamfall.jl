<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Simple two-system interaction · Streamfall Documentation</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="Streamfall Documentation logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Streamfall Documentation</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Streamfall.jl Documentation</a></li><li><a class="tocitem" href="../../primer/">Primer</a></li><li><a class="tocitem" href="../../expected_data_formats/">Input data format</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/">Examples</a></li><li><a class="tocitem" href="../node_creation/">Node creation</a></li><li><a class="tocitem" href="../network_loading/">Network Loading</a></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">Calibration</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../calibration/">Example calibration</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox" checked/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">Model evaluation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../simple_showcase/">A simple example</a></li><li><a class="tocitem" href="../model_comparison/">Model comparison example</a></li><li class="is-active"><a class="tocitem" href>Simple two-system interaction</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-6" type="checkbox"/><label class="tocitem" for="menuitem-4-6"><span class="docs-label">Ensemble modeling</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../weighted_ensembles/">Weighted Ensemble Modeling</a></li></ul></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../../metrics/">Included metrics</a></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Nodes</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../API/nodes/Node/">Generic node methods</a></li><li><a class="tocitem" href="../../API/nodes/IHACRES/">IHACRES</a></li><li><a class="tocitem" href="../../API/nodes/HyMod/">HyMod</a></li><li><a class="tocitem" href="../../API/nodes/GR4J/">GR4J</a></li><li><a class="tocitem" href="../../API/nodes/SYMHYD/">SYMHYD</a></li><li><a class="tocitem" href="../../API/nodes/Dam/">Dam (Storage Level)</a></li></ul></li><li><a class="tocitem" href="../../API/plotting/">Plotting</a></li><li><a class="tocitem" href="../../API/network/">Network</a></li><li><a class="tocitem" href="../../API/climate/">Climate</a></li><li><a class="tocitem" href="../../API/use_methods/">Methods to run a network or node</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li><a class="is-disabled">Model evaluation</a></li><li class="is-active"><a href>Simple two-system interaction</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Simple two-system interaction</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ConnectedSystems/Streamfall.jl/blob/main/docs/src/examples/simple_multisystem.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Simple-two-system-interaction"><a class="docs-heading-anchor" href="#Simple-two-system-interaction">Simple two-system interaction</a><a id="Simple-two-system-interaction-1"></a><a class="docs-heading-anchor-permalink" href="#Simple-two-system-interaction" title="Permalink"></a></h1><p>Here, a two-node network including a river and a dam is represented. The example is based on the Lower Campaspe catchment - a small semi-arid basin in North-Central Victoria, Australia.</p><p><img src="../../assets/two_node_network.svg" alt/></p><p>The dam is the primary water store for farmers in the area. In this simplified example, we investigate the effect of changing water demands and related policies on historic dam levels. Water demands may shift due to choice in cultivated crops, changing water management practices, investment into more efficient irrigation systems, choice in crops, or a systemic change to water policies.</p><p>In essence, this is a cursory investigation into &quot;what might have been&quot; if the regional context were different.</p><p>For the purpose of this example, the farm water requirements are defined as a volume of daily water requirements throughout a growing season. A growing season is the period of time over which a crop is cultivated, and is assumed to be between <em>May</em> and <em>February</em>. In practice, water requirements are provided by another model.</p><pre><code class="language-julia hljs">using CSV, DataFrames, YAML
using Dates
using Plots
using Streamfall

# Load climate data - in this case from a CSV file with data for all nodes.
# Indicate which columns are precipitation and evaporation data based on partial identifiers
climate = Climate(&quot;../test/data/campaspe/climate/climate.csv&quot;, &quot;_rain&quot;, &quot;_evap&quot;)

# Historic extractions from the dam
extraction_data = CSV.read(&quot;../test/data/campaspe/gauges/dam_extraction.csv&quot;, DataFrame; comment=&quot;#&quot;)

# Load the example network
sn = load_network(&quot;Example Network&quot;, &quot;../test/data/campaspe/two_node_network.yml&quot;)

# Run the model for the basin to obtain baseline values
run_basin!(sn, climate; extraction=extraction_data)
baseline_dam_level = sn[2].level
baseline_dam_outflow = sn[2].outflow

# Get represented dates for simulation
sim_dates = Streamfall.timesteps(climate)

# Create DataFrame to use as a template to store water extractions
extractions = copy(extraction_data)

&quot;&quot;&quot;
Convenience function handling interactions with all &quot;external&quot; models.
Note: We are using a burn-in period of a year.
&quot;&quot;&quot;
function run_scenario(sn, climate, extractions, increased_demand; burn_in=366)
    reset!(sn)
    inlets, outlets = find_inlets_and_outlets(sn)

    extractions = copy(extractions)

    sim_dates = Streamfall.timesteps(climate)
    prep_state!(sn, length(sim_dates))

    for (ts, date) in enumerate(sim_dates)
        if ((month(date) &gt;= 5) || (month(date) &lt;= 2))
            # Within growing season (May - Feb)

            # Additional agricultural water demand (ML/day) from historic conditions
            # This would normally come from another model indicating daily water demands.
            extractions[ts, &quot;406000_releases_[ML]&quot;] += increased_demand
        end

        for outlet in outlets
            run_node!(sn, outlet, climate, ts; extraction=extractions)
        end
    end

    # Return dam levels for assessment
    return sn[2].level[burn_in:end]
end

&quot;&quot;&quot;
A hypothetical Critical Threshold index.

Mean of proportional distance to critical threshold (default 55% of dam capacity).
Values of 1 indicate the dam is always full, negative values indicate the dam levels are
below the critical threshold.

Greater values indicate greater water security but may have trade-offs with regard to
environmental outcomes and farm profitability.
&quot;&quot;&quot;
function critical_threshold_index(levels; threshold=0.55)
    max_level = 195
    min_level = 160  # mAHD

    # Essentially proportion of dam capacity
    relative_level = ((levels .- min_level) ./ (max_level - min_level))

    # Distance
    indicator = (relative_level .- threshold) ./ (1.0 - threshold)

    return round(mean(indicator), digits=4)
end


ct_index = critical_threshold_index(baseline_dam_level[366:end])
f = plot(sim_dates[366:end], baseline_dam_level[366:end]; label=&quot;Historic modelled ($(ct_index))&quot;)
results = Vector{Vector{Float64}}(undef, 5)

for (i, daily_demand) in enumerate([-2.0, -0.5, 1.0, 3.0, 5.0])
    results[i] = run_scenario(sn, climate, extractions, daily_demand)

    ct_index = critical_threshold_index(results[i])

    plot!(sim_dates[366:end], results[i]; label = &quot;+$(daily_demand) ML/day ($(ct_index))&quot;)
end
display(f)
# savefig(&quot;simple_water_demand.png&quot;)

Streamfall.temporal_cross_section(sim_dates, calib_data[:, &quot;406000&quot;], sn[2].level)</code></pre><p><img src="../../assets/simple_water_demand.png" alt/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../model_comparison/">« Model comparison example</a><a class="docs-footer-nextpage" href="../weighted_ensembles/">Weighted Ensemble Modeling »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Sunday 2 February 2025 12:24">Sunday 2 February 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
